obj-m += gpio_sim.o
obj-m += sensor_sim.o
obj-m += led_matrix.o
obj-m += controlador.o

KDIR := /lib/modules/$(shell uname -r)/build
PWD  := $(shell pwd)

all:
	@echo "[ðŸ§¹] Limpiando mÃ³dulos y binarios..."
	sudo rmmod controlador 2>/dev/null || true
	sudo rmmod led_matrix 2>/dev/null || true
	sudo rmmod sensor_sim 2>/dev/null || true
	sudo rmmod gpio_sim 2>/dev/null || true
	make -C $(KDIR) M=$(PWD) clean

	@echo "[ðŸ› ] Compilando mÃ³dulos..."
	make -C $(KDIR) M=$(PWD) modules

	@echo "[ðŸ”] Cargando mÃ³dulos..."
	sudo insmod gpio_sim.ko
	sudo insmod sensor_sim.ko
	sudo insmod led_matrix.ko
	sudo insmod controlador.ko

	@echo "[âœ…] Sistema listo. Usa: sudo dmesg -w"

clean:
	@echo "[ðŸ§¼] Limpiando..."
	sudo rmmod controlador 2>/dev/null || true
	sudo rmmod led_matrix 2>/dev/null || true
	sudo rmmod sensor_sim 2>/dev/null || true
	sudo rmmod gpio_sim 2>/dev/null || true
	make -C $(KDIR) M=$(PWD) clean
